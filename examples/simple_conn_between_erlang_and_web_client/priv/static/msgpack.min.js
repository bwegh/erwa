("function"==typeof define?function(a){define("msgpack-js",a)}:"object"==typeof exports?function(a){module.exports=a()}:function(a){this.msgpack=a()})(function(){"use strict";function a(a){if(void 0===a)return"undefined";var b,c;if(a instanceof ArrayBuffer?(c="ArrayBuffer",b=new DataView(a)):a instanceof DataView&&(c="DataView",b=a),!b)return JSON.stringify(a);for(var d=[],e=0;e<a.byteLength;e++){if(e>20){d.push("...");break}var f=b.getUint8(e).toString(16);1===f.length&&(f="0"+f),d.push(f)}return"<"+c+" "+d.join(" ")+">"}function b(a,b,c){for(var d=(a.byteLength,0),e=c.length;e>d;d++){var f=c.charCodeAt(d);if(128>f)a.setUint8(b++,f>>>0&127|0);else if(2048>f)a.setUint8(b++,f>>>6&31|192),a.setUint8(b++,f>>>0&63|128);else if(65536>f)a.setUint8(b++,f>>>12&15|224),a.setUint8(b++,f>>>6&63|128),a.setUint8(b++,f>>>0&63|128);else{if(!(1114112>f))throw new Error("bad codepoint "+f);a.setUint8(b++,f>>>18&7|240),a.setUint8(b++,f>>>12&63|128),a.setUint8(b++,f>>>6&63|128),a.setUint8(b++,f>>>0&63|128)}}}function c(a,b,c){for(var d="",e=b,f=b+c;f>e;e++){var g=a.getUint8(e);if(0!==(128&g))if(192!==(224&g))if(224!==(240&g)){if(240!==(248&g))throw new Error("Invalid byte "+g.toString(16));d+=String.fromCharCode((7&g)<<18|(63&a.getUint8(++e))<<12|(63&a.getUint8(++e))<<6|(63&a.getUint8(++e))<<0)}else d+=String.fromCharCode((15&g)<<12|(63&a.getUint8(++e))<<6|(63&a.getUint8(++e))<<0);else d+=String.fromCharCode((15&g)<<6|63&a.getUint8(++e));else d+=String.fromCharCode(g)}return d}function d(a){for(var b=0,c=0,d=a.length;d>c;c++){var e=a.charCodeAt(c);if(128>e)b+=1;else if(2048>e)b+=2;else if(65536>e)b+=3;else{if(!(1114112>e))throw new Error("bad codepoint "+e);b+=4}}return b}function e(a,b){this.offset=b||0,this.view=a}function f(a){var b=new jDataView(a),c=new e(b),d=c.parse();if(c.offset!==a.byteLength)throw new Error(a.byteLength-c.offset+" trailing bytes");return d}function g(a,c,e){var f,h,i,j,k=typeof a;if("string"===k){if(f=d(a),32>f)return c.setUint8(e,160|f),b(c,e+1,a),1+f;if(256>f)return c.setUint8(e,217),c.setUint16(e+1,f),b(c,e+2,a),2+f;if(65536>f)return c.setUint8(e,218),c.setUint16(e+1,f),b(c,e+3,a),3+f;if(4294967296>f)return c.setUint8(e,219),c.setUint32(e+1,f),b(c,e+5,a),5+f}if(a instanceof ArrayBuffer){if(f=a.byteLength,256>f)return c.setUint8(e,196),c.setUint16(e+1,f),new Uint8Array(c.buffer).set(new Uint8Array(a),e+2),2+f;if(65536>f)return c.setUint8(e,216),c.setUint16(e+1,f),new Uint8Array(c.buffer).set(new Uint8Array(a),e+3),3+f;if(4294967296>f)return c.setUint8(e,217),c.setUint32(e+1,f),new Uint8Array(c.buffer).set(new Uint8Array(a),e+5),5+f}if("number"===k){if(a%1!==0)return c.setUint8(e,203),c.setFloat64(e+1,a),9;if(a>=0){if(128>a)return c.setUint8(e,a),1;if(256>a)return c.setUint8(e,204),c.setUint8(e+1,a),2;if(65536>a)return c.setUint8(e,205),c.setUint16(e+1,a),3;if(4294967296>a)return c.setUint8(e,206),c.setUint32(e+1,a),5;if(0x10000000000000000>a)return c.setUint8(e,207),c.setUint64(e+1,a),9;throw new Error("Number too big 0x"+a.toString(16))}if(a>=-32)return c.setInt8(e,a),1;if(a>=-128)return c.setUint8(e,208),c.setInt8(e+1,a),2;if(a>=-32768)return c.setUint8(e,209),c.setInt16(e+1,a),3;if(a>=-2147483648)return c.setUint8(e,210),c.setInt32(e+1,a),5;if(a>=-2147483648)return c.setUint8(e,211),c.setUint64(e+1,a),9;throw new Error("Number too small -0x"+(-a).toString(16).substr(1))}if("undefined"===k)return c.setUint8(e,212),c.setUint8(e+1,0),c.setUint8(e+2,0),1;if(null===a)return c.setUint8(e,192),1;if("boolean"===k)return c.setUint8(e,a?195:194),1;if("function"==typeof a.toJSON)return g(a.toJSON(),c,e);if("object"===k){if(h=0,i=Array.isArray(a))f=a.length;else{var l=Object.keys(a);f=l.length}if(16>f?(c.setUint8(e,f|(i?144:128)),h=1):65536>f?(c.setUint8(e,i?220:222),c.setUint16(e+1,f),h=3):4294967296>f&&(c.setUint8(e,i?221:223),c.setUint32(e+1,f),h=5),i)for(j=0;f>j;j++)h+=g(a[j],c,e+h);else for(j=0;f>j;j++){var m=l[j];h+=g(m,c,e+h),h+=g(a[m],c,e+h)}return h}throw new Error("Unknown type "+k)}function h(a){var b,c,e,f,g=typeof a;if("string"===g){if(b=d(a),32>b)return 1+b;if(256>b)return 2+b;if(65536>b)return 3+b;if(4294967296>b)return 5+b}if(a instanceof ArrayBuffer){if(b=a.byteLength,256>b)return 2+b;if(65536>b)return 3+b;if(4294967296>b)return 5+b}if("number"===g){if(a<<0!==a)return 9;if(a>=0){if(128>a)return 1;if(256>a)return 2;if(65536>a)return 3;if(4294967296>a)return 5;if(0x10000000000000000>a)return 9;throw new Error("Number too big 0x"+a.toString(16))}if(a>=-32)return 1;if(a>=-128)return 2;if(a>=-32768)return 3;if(a>=-2147483648)return 5;if(a>=-0x8000000000000000)return 9;throw new Error("Number too small -0x"+a.toString(16).substr(1))}if("boolean"===g||null===a)return 1;if("undefined"===g)return 3;if("function"==typeof a.toJSON)return h(a.toJSON());if("object"===g){if("function"==typeof a.toJSON&&(a=a.toJSON()),c=0,Array.isArray(a))for(b=a.length,f=0;b>f;f++)c+=h(a[f]);else for(e=Object.keys(a),b=e.length,f=0;b>f;f++)c+=h(e[f])+h(a[e[f]]);if(16>b)return 1+c;if(65536>b)return 3+c;if(4294967296>b)return 5+c;throw new Error("Array or object too long 0x"+b.toString(16))}if("function"===g)return 0;throw new Error("Unknown type "+g)}var i={};return i.inspect=a,i.utf8Write=b,i.utf8Read=c,i.utf8ByteCount=d,i.encode=function(a){var b=new ArrayBuffer(h(a)),c=new jDataView(b);return g(a,c,0),b},i.decode=f,e.prototype.map=function(a){for(var b={},c=0;a>c;c++){var d=this.parse();b[d]=this.parse()}return b},e.prototype.buf=function(a){var b=new ArrayBuffer(a);return new Uint8Array(b).set(new Uint8Array(this.view.buffer,this.offset,a),0),this.offset+=a,b},e.prototype.u8str=function(a){var b=c(this.view,this.offset,a);return this.offset+=a,b},e.prototype.array=function(a){for(var b=new Array(a),c=0;a>c;c++)b[c]=this.parse();return b},e.prototype.parse=function(){var a,b,c,d=this.view.getUint8(this.offset);if(0===(128&d))return this.offset++,d;if(128===(240&d))return b=15&d,this.offset++,this.map(b);if(144===(240&d))return b=15&d,this.offset++,this.array(b);if(160===(224&d))return b=31&d,this.offset++,this.u8str(b);if(224===(224&d))return a=this.view.getInt8(this.offset),this.offset++,a;switch(d){case 192:return this.offset++,null;case 194:return this.offset++,!1;case 195:return this.offset++,!0;case 196:return b=this.view.getUint8(this.offset+1),this.offset+=2,this.buf(b);case 197:return b=this.view.getUint16(this.offset+1),this.offset+=3,this.buf(b);case 198:return b=this.view.getUint32(this.offset+1),this.offset+=5,this.buf(b);case 199:return b=this.view.getUint8(this.offset+1),c=this.view.getUint8(this.offset+2),this.offset+=3,[c,this.buf(b)];case 200:return b=this.view.getUint16(this.offset+1),c=this.view.getUint8(this.offset+3),this.offset+=4,[c,this.buf(b)];case 201:return b=this.view.getUint32(this.offset+1),c=this.view.getUint8(this.offset+5),this.offset+=6,[c,this.buf(b)];case 202:return a=this.view.getFloat32(this.offset+1),this.offset+=5,a;case 203:return a=this.view.getFloat64(this.offset+1),this.offset+=9,a;case 204:return a=this.view.getUint8(this.offset+1),this.offset+=2,a;case 205:return a=this.view.getUint16(this.offset+1),this.offset+=3,a;case 206:return a=this.view.getUint32(this.offset+1),this.offset+=5,a;case 207:return a=this.view.getUint64(this.offset+1),this.offset+=9,parseInt(a);case 208:return a=this.view.getInt8(this.offset+1),this.offset+=2,a;case 209:return a=this.view.getInt16(this.offset+1),this.offset+=3,a;case 210:return a=this.view.getInt32(this.offset+1),this.offset+=5,a;case 211:return a=this.view.getInt64(this.offset+1),this.offset+=9,parseInt(a);case 212:return c=this.view.getUint8(this.offset+1),a=this.view.getUint8(this.offset+2),this.offset+=3,0===c&&0===a?void 0:[c,a];case 213:return c=this.view.getUint8(this.offset+1),this.offset+=2,[c,this.buf(2)];case 214:return c=this.view.getUint8(this.offset+1),this.offset+=2,[c,this.buf(4)];case 215:return c=this.view.getUint8(this.offset+1),this.offset+=2,[c,this.buf(8)];case 216:return c=this.view.getUint8(this.offset+1),this.offset+=2,[c,this.buf(16)];case 217:return b=this.view.getUint8(this.offset+1),this.offset+=2,this.u8str(b);case 218:return b=this.view.getUint16(this.offset+1),this.offset+=3,this.u8str(b);case 219:return b=this.view.getUint32(this.offset+1),this.offset+=5,this.u8str(b);case 220:return b=this.view.getUint16(this.offset+1),this.offset+=3,this.array(b);case 221:return b=this.view.getUint32(this.offset+1),this.offset+=5,this.array(b);case 222:return b=this.view.getUint16(this.offset+1),this.offset+=3,this.map(b);case 223:return b=this.view.getUint32(this.offset+1),this.offset+=5,this.map(b)}throw new Error("Unknown type 0x"+d.toString(16))},i});